---
layout: default
title:  "如何为git设计文件系统"
date:   2018-03-28
categories: file system
---

# 如何为git设计文件系统

前面分析了git的存储原理，核心特点如下：

## 极其小的小文件

我们来看看git的基本动作都对存储做了些啥：

- git init初始化一个仓库，生成.git目录下的一些小文件和目录，比如HEADS, objects，config, info, refs等
- git add了一个新文件test.txt，会在本地文件系统创建一个以文件内容hash为文件名的文件，并写入文件内容
- git commit这个文件，有2个步骤：
  - 会在本地文件系统创建一个以test.txt+文件key为内容的tree对象(几十字节)，其实也是一个小文件，文件名为内容的hash；
  - 创建一个commit对象（小文件），内容为commit填写的消息，提交者信息，文件名为内容的hash。
- 给txt文件添加一行，提交，三个动作：
  - 会在本地文件系统创建一个以文件内容hash为文件名的新文件，并写入文件内容
  - 创建tree对象（同上第一步）
  - 创建commit对象（同上第二步）
- 删除test.txt，git commit这次修改，也有2个步骤：
  - 创建一个新的tree对象，对应的内容为空；
  - 创建一个新的commit对象，内容为commit提交的信息，作者信息，文件名为内容的hash

经过上面一通操作，我们得到了一个啥都没有的仓库，但是后台却相比多了13个小文件，其中objects目录下多了8个小文件。（都是几十字节级别）

## 垃圾回收
